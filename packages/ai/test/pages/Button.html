<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta charset="utf-8">

	<title>AI Button</title>
	<script>
		// delete Document.prototype.adoptedStyleSheets
	</script>


	<script src="%VITE_BUNDLE_PATH%" type="module"></script>


<!--	<link rel="stylesheet" type="text/css" href="./styles/AiButton.css"> -->

</head>

<body>
	<ui5-button icon="ai" end-icon="navigation-down-arrow"></ui5-button>

	<ui5-ai-button id="myAiButton1">
		<ui5-ai-button-state key="generate" text1="Generate" icon="ai" next-state="generating"></ui5-ai-button-state>
		<ui5-ai-button-state key="generating" text1="Stop Generation" icon="stop" next-state="revise"></ui5-ai-button-state>
		<ui5-ai-button-state key="pause" text1="Pause" icon="pause" next-state="generating"></ui5-ai-button-state>
		<ui5-ai-button-state key="revise" text1="Revise" icon="ai" end-icon="navigation-down-arrow" next-state="generate"></ui5-ai-button-state>
	</ui5-ai-button>

	<ui5-ai-button id="myAiButton">
		<ui5-ai-button-state key="generate" text="Generate" icon="ai" next-state="generating"></ui5-ai-button-state>
		<ui5-ai-button-state key="generating" text="Stop Generation" icon="stop" next-state="generate"></ui5-ai-button-state>
		<ui5-ai-button-state key="revise" text="Revise" icon="ai" end-icon="navigation-down-arrow"></ui5-ai-button-state>
		<ui5-ai-button-state key="pause" text="Pause" icon="pause" next-state="generating"></ui5-ai-button-state>
	</ui5-ai-button>

	<ui5-menu id="menu">
		<ui5-menu-item text="Regenerate"></ui5-menu-item>
		<ui5-menu-item text="Fix Spelling & Grammar" starts-section></ui5-menu-item>
		<ui5-menu-item text="Change Tone">
			<ui5-menu-item text="Option 1"></ui5-menu-item>
			<ui5-menu-item text="Option 2"></ui5-menu-item>
			<ui5-menu-item text="Option 3"></ui5-menu-item>
		</ui5-menu-item>
		<ui5-menu-item text="Text Length">
			<ui5-menu-item text="Short"></ui5-menu-item>
			<ui5-menu-item text="Medium"></ui5-menu-item>
			<ui5-menu-item text="Long"></ui5-menu-item>
		</ui5-menu-item>
		<ui5-menu-item text="Bulleted List"></ui5-menu-item>
		<ui5-menu-item text="Translate">
			<ui5-menu-item text="English"></ui5-menu-item>
			<ui5-menu-item text="German"></ui5-menu-item>
			<ui5-menu-item text="Spanish"></ui5-menu-item>
		</ui5-menu-item>
	</ui5-menu>

	<script>
		var generationId;

		function startGeneration() {
			console.warn("startGeneration");
			generationId = setTimeout(function() {
				console.warn("Generation completed");
				myAiButton.state = "revise";
			}, 3000);
		}

		function stopGeneration() {
			console.warn("stopGeneration");
			clearTimeout(generationId);
		}

		myAiButton.addEventListener("click", function(e) {
			const aiButton = e.target;
			if (aiButton.state === "revise") {
				// menu.showAt(myAiButton);
				menu.opener = myAiButton;
				menu.open = true;
			} else if (e.target.state === "generating") {
				// e.preventDefault();
				// stopGeneration();
				// aiButton.state = "pause";
			}
		});

		myAiButton.addEventListener("state-change", function(e) {
			const state = e.detail.state;

			console.warn(e.detail);

			if (state === "generate" || state === "pause") {
				stopGeneration();
			} else if (state === "generating") {
				startGeneration();
			}
		});

		menu.addEventListener("item-click", function(evt) {
			if (evt.detail.text === "Regenerate") {
				myAiButton.state = "generating";
				startGeneration();
			}
		});

	</script>

</body>
</html>
