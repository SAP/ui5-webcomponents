<div class="ui5-multi-combobox-root"
	@focusin={{rootFocusIn}}
	@focusout={{rootFocusOut}}
	role="combobox"
	aria-haspopup="listbox"
	aria-expanded="{{open}}"
>
	<span id="{{_id}}-hiddenText-nMore" class="ui5-hidden-text">{{nMoreCountText}}</span>
	
	{{#if hasValueState}}
		<span id="{{_id}}-valueStateDesc" class="ui5-hidden-text">{{valueStateText}}</span>
	{{/if}}
	
	<ui5-tokenizer slot="_beginContent"
		show-more
		class="ui5-multi-combobox-tokenizer"
		?disabled="{{disabled}}"
		compact-size="{{effectiveContentDensity}}"
		@ui5-showMoreItemsPress="{{_showMorePopover}}"
		@ui5-tokenDelete="{{_tokenDelete}}"
		@focusout="{{_tokenizerFocusOut}}"
		?expanded="{{expandedTokenizer}}"
	>
		{{#each items}}
			{{#if this.selected}}
				<ui5-token compact-size="{{effectiveContentDensity}}" ?readonly="{{../readonly}}" class="ui5-multi-combobox-token" data-ui5-id="{{this._id}}" >{{this.textContent}}</ui5-token>
			{{/if}}
		{{/each}}
	</ui5-tokenizer>

	<input id="ui5-multi-combobox-input"
		.value="{{value}}"
		inner-input
		placeholder="{{placeholder}}"
		?disabled={{disabled}}
		?readonly={{readonly}}
		?required={{required}}
		value-state="{{valueState}}"
		@input="{{_inputLiveChange}}"
		@change={{_inputChange}}
		@keydown="{{_onkeydown}}"
		@keyup="{{_onkeyup}}"
		@focusin="{{_focusin}}"
		@focusout="{{_focusout}}"
		aria-autocomplete="both"
		aria-labelledby="{{_id}}-hiddenText-nMore"
		aria-describedby="{{_id}}-valueStateDesc"
	/>

	{{#unless readonly}}
		<ui5-icon name="slim-arrow-down"
			compact-size="{{effectiveContentDensity}}"
			input-icon
			slot="icon"
			tabindex="-1"
			@click={{_showAllItemsPopover}}
			?pressed="{{_iconPressed}}"
			dir="{{dir}}"
		></ui5-icon>
	{{/unless}}

	<ui5-popover
		class="ui5-multi-combobox-selected-items-popover"
		horizontal-align="Stretch"
		?no-arrow={{editable}}
		placement-type="Bottom"
		compact-size="{{effectiveContentDensity}}">
		<ui5-list separators="None" mode="{{selectedItemsListMode}}"
			@ui5-selectionChange={{_listSelectionChange}} compact-size="{{effectiveContentDensity}}">
			{{#each items}}
				{{#if this.selected}}
					<ui5-li type="Active" data-ui5-token-id="{{this._id}}" .selected="{{../editable}}" compact-size="{{effectiveContentDensity}}">{{this.textContent}}</ui5-li>
				{{/if}}
			{{/each}}
		</ui5-list>
	</ui5-popover>

	<ui5-popover class="ui5-multi-combobox-all-items-popover"
		no-arrow
		horizontal-align="Stretch"
		initial-focus="ui5-multi-combobox-input"
		horizontal-align="Left"
		placement-type="Bottom"
		@ui5-selectionChange={{_listSelectionChange}}
		@ui5-afterClose={{_toggleIcon}}
		@ui5-afterOpen={{_toggleIcon}}
		compact-size="{{effectiveContentDensity}}">
		<ui5-list separators="None" mode="MultiSelect" class="ui5-multi-combobox-all-items-list" compact-size="{{effectiveContentDensity}}">
			{{#each _filteredItems}}
					<ui5-li type="Active" compact-size="{{effectiveContentDensity}}" ?selected={{this.selected}} data-ui5-token-id="{{this._id}}">{{this.textContent}}</ui5-li>
			{{/each}}
		</ui5-list>
	</ui5-popover>

</div>
