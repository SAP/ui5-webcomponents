<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Dynamic Tree Test</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<script data-ui5-config type="application/json">
		{
			"language": "EN"
		}
	</script>

	<script src="%VITE_BUNDLE_PATH%" type="module"></script>

	<style>
        body {
            background-color: var(--sapBackgroundColor);
        }
		.controls {
			margin: 20px 0;
			display: flex;
			gap: 15px;
			align-items: center;
			flex-wrap: wrap;
		}
		.control-group {
			display: flex;
			gap: 10px;
			align-items: center;
		}
		.tree-container {
			height: 400px;
			overflow: auto;
			border: 1px solid #ccc;
			margin: 20px 0;
		}
		ui5-label {
			min-width: 100px;
		}
	</style>
</head>

<body>
	<ui5-title level="H1">Dynamic Tree Test</ui5-title>
	<ui5-text>Control the number of nodes and nesting levels to test tree performance and behavior.</ui5-text>

	<div class="controls">
		<div class="control-group">
			<ui5-label>Nodes per level:</ui5-label>
			<ui5-input id="nodesInput" value="5" type="Number" min="1" max="100"></ui5-input>
		</div>
		
		<div class="control-group">
			<ui5-label>Nesting levels:</ui5-label>
			<ui5-input id="levelsInput" value="3" type="Number" min="1" max="10"></ui5-input>
		</div>
		
		<div class="control-group">
			<ui5-label>Selection mode:</ui5-label>
			<ui5-select id="selectionMode">
				<ui5-option>None</ui5-option>
				<ui5-option>Single</ui5-option>
				<ui5-option selected>Multiple</ui5-option>
			</ui5-select>
		</div>
		
		<ui5-button id="generateBtn" design="Emphasized">Generate Tree</ui5-button>
		<ui5-button id="expandAllBtn">Expand All</ui5-button>
		<ui5-button id="collapseAllBtn">Collapse All</ui5-button>
		<ui5-button id="clearBtn" design="Negative">Clear</ui5-button>
	</div>

	<div class="controls">
		<ui5-text id="nodeCount">Total nodes: 0</ui5-text>
		<ui5-text id="performance"></ui5-text>
	</div>

	<div class="tree-container">
		<ui5-tree id="dynamicTree" selection-mode="Multiple">
			<div slot="header">
				<ui5-title level="H3">Generated Tree</ui5-title>
			</div>
		</ui5-tree>
	</div>

	<script>
		const tree = document.getElementById('dynamicTree');
		const nodesInput = document.getElementById('nodesInput');
		const levelsInput = document.getElementById('levelsInput');
		const selectionMode = document.getElementById('selectionMode');
		const generateBtn = document.getElementById('generateBtn');
		const expandAllBtn = document.getElementById('expandAllBtn');
		const collapseAllBtn = document.getElementById('collapseAllBtn');
		const clearBtn = document.getElementById('clearBtn');
		const nodeCount = document.getElementById('nodeCount');
		const performance = document.getElementById('performance');

		let totalNodes = 0;

		function createTreeNode(text, level, maxLevel, nodesPerLevel, expanded = false) {
			const item = document.createElement('ui5-tree-item');
			item.text = text;
			item.expanded = expanded;
			totalNodes++;

			// Store metadata for lazy loading
			item.dataset.level = level;
			item.dataset.maxLevel = maxLevel;
			item.dataset.nodesPerLevel = nodesPerLevel;
			item.dataset.baseText = text;

			// If not at max level, mark as having children but don't create them yet
			if (level < maxLevel) {
				item.hasChildren = true;
			}

			return item;
		}

		function createChildNodes(parentItem) {
			const level = parseInt(parentItem.dataset.level);
			const maxLevel = parseInt(parentItem.dataset.maxLevel);
			const nodesPerLevel = parseInt(parentItem.dataset.nodesPerLevel);
			const baseText = parentItem.dataset.baseText;

			// Only create children if not at max level and children don't exist yet
			if (level < maxLevel && parentItem.children.length === 0) {
				for (let i = 1; i <= nodesPerLevel; i++) {
					const childText = `${baseText}.${i}`;
					const child = createTreeNode(childText, level + 1, maxLevel, nodesPerLevel);
					parentItem.appendChild(child);
				}
			}
		}

		function generateTree() {
			const startTime = Date.now();
			totalNodes = 0;

			// Clear existing tree
			const existingItems = tree.querySelectorAll('ui5-tree-item');
			existingItems.forEach(item => item.remove());

			const nodes = parseInt(nodesInput.value) || 5;
			const levels = parseInt(levelsInput.value) || 3;

			// Generate root nodes
			for (let i = 1; i <= nodes; i++) {
				const rootText = `Node ${i}`;
				const rootNode = createTreeNode(rootText, 1, levels, nodes);
				tree.appendChild(rootNode);
			}

			const endTime = Date.now();
			const duration = (endTime - startTime);

			nodeCount.textContent = `Total nodes: ${totalNodes}`;
			performance.textContent = `Generated in ${duration}ms`;
		}

		function expandAll() {
			const startTime = Date.now();
			tree.walk((node) => {
				if (!node.expanded && node.hasChildren) {
					createChildNodes(node);
				}
				node.expanded = true;
			});
			const endTime = Date.now();
			performance.textContent = `Expanded all in ${(endTime - startTime)}ms - Total nodes: ${totalNodes}`;
		}

		function collapseAll() {
			const startTime = Date.now();
			tree.walk((node) => {
				node.expanded = false;
			});
			const endTime = Date.now();
			performance.textContent = `Collapsed all in ${(endTime - startTime)}ms`;
		}

		function clearTree() {
			const existingItems = tree.querySelectorAll('ui5-tree-item');
			existingItems.forEach(item => item.remove());
			totalNodes = 0;
			nodeCount.textContent = 'Total nodes: 0';
			performance.textContent = '';
		}

		// Event listeners
		generateBtn.addEventListener('click', generateTree);
		expandAllBtn.addEventListener('click', expandAll);
		collapseAllBtn.addEventListener('click', collapseAll);
		clearBtn.addEventListener('click', clearTree);

		selectionMode.addEventListener('ui5-change', (event) => {
			const newMode = event.detail.selectedOption.textContent;
			tree.selectionMode = newMode;
		});

		// Tree event listeners
		tree.addEventListener('ui5-selection-change', (event) => {
			console.log('Selection changed:', event.detail.selectedItems.length, 'items selected');
		});

		tree.addEventListener('ui5-item-toggle', (event) => {
            debugger
			const item = event.detail.item;
			console.log('Item toggled:', item.text, 'expanded:', item.expanded);
			
			// Lazy load children when expanding
			if (!item.expanded) {
				createChildNodes(item);
			}
		});

		tree.addEventListener('ui5-item-click', (event) => {
			console.log('Item clicked:', event.detail.item.text);
		});

		// Generate initial tree
		generateTree();
	</script>
</body>

</html>
