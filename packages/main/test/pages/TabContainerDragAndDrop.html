<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Tab Container Drag and Drop</title>

	<script src="%VITE_BUNDLE_PATH%" type="module"></script>
	<link rel="stylesheet" type="text/css" href="./styles/TabContainer.css">
</head>

<body class="tabcontainer1auto">
	<ui5-checkbox id="reorder" text="Draggable tabs" checked></ui5-checkbox>
	<ui5-checkbox id="density" text="Compact density"></ui5-checkbox>
	<ui5-step-input id="maxNestingLevelInput" placeholder="maxNestingLevel" value="1"></ui5-step-input>

	<section>
		<h2>Drag and drop</h2>
		<ui5-tabcontainer id="tabContainerDnd" collapsed fixed max-nesting-level="1">
			<ui5-tab id="tabOne" draggable="true" design="Positive" text="One"></ui5-tab>
			<ui5-tab id="tabTwo" draggable="true" design="Negative" text="Two" disabled>
				<ui5-tab slot="subTabs" draggable="true" text="2.1"></ui5-tab>
			</ui5-tab>
			<ui5-tab id="tabThree" draggable="true" design="Critical" text="Three">
				<ui5-tab slot="subTabs" draggable="true" design="Positive" text="3.1">
					<ui5-button>Button 3</ui5-button>
				</ui5-tab>
				content
			</ui5-tab>
			<ui5-tab id="tabFour" draggable="true" text="Four (forbids nesting)"></ui5-tab>

			<ui5-tab id="tabFive" draggable="true" text="Five">
				<ui5-tab slot="subTabs" draggable="true" text="nested in Five">
					<ui5-tab slot="subTabs" draggable="true" text="nested deeper in Five">text</ui5-tab>
					text
				</ui5-tab>
			</ui5-tab>

			<ui5-tab id="tabSix" draggable="true" text="Six"></ui5-tab>
			<ui5-tab id="tabSeven" draggable="true" text="Seven"></ui5-tab>
			<ui5-tab-separator></ui5-tab-separator>
			<ui5-tab id="tabEight" draggable="true" design="Positive" text="Eight"></ui5-tab>
			<ui5-tab id="tabNine" draggable="true" design="Negative" text="Nine"></ui5-tab>
			<ui5-tab id="tabTen" draggable="true" design="Critical" text="Ten"></ui5-tab>
			<ui5-tab id="tabEleven" draggable="true" text="Eleven"></ui5-tab>
			<ui5-tab-separator></ui5-tab-separator>
			<ui5-tab id="tabTwelve" draggable="true" text="Twelve"></ui5-tab>
			<ui5-tab id="tabThirteen" draggable="true" text="Thirteen" selected></ui5-tab>
			<ui5-tab id="tabFourteen" draggable="true" text="Fourteen"></ui5-tab>
			<ui5-tab id="tabFifteen" draggable="true" text="Fifteen"></ui5-tab>
			<ui5-tab id="tabSixteen" draggable="true" text="Sixteen"></ui5-tab>
			<ui5-tab id="tabSeventeen" draggable="true" text="Seventeen (forbids nesting)"></ui5-tab>
			<ui5-tab id="tabEighteen" draggable="true" text="Eighteen"></ui5-tab>
			<ui5-tab-separator></ui5-tab-separator>
			<ui5-tab id="tabNinteen" draggable="true" text="Nineteen"></ui5-tab>
			<ui5-tab id="tabTwenty" draggable="true" text="Twenty"></ui5-tab>
			<ui5-tab id="tabTwentyOne" draggable="true" text="Twenty One"></ui5-tab>
			<ui5-tab id="tabTwentyTwo" draggable="true" text="Twenty Two"></ui5-tab>
			<ui5-tab id="tabTwentyThree" draggable="true" text="Twenty Three"></ui5-tab>
			<ui5-tab id="tabTwentyFour" draggable="true" text="Twenty Four"></ui5-tab>
			<ui5-tab-separator></ui5-tab-separator>
			<ui5-tab id="tabTwnetyFive" draggable="true" text="Twenty Five"></ui5-tab>
			<ui5-tab id="tabTwnetySix" draggable="true" text="Twenty Six"></ui5-tab>
			<ui5-tab id="tabTwnetySeven" draggable="true" text="Twenty Seven"></ui5-tab>
			<ui5-tab-separator></ui5-tab-separator>
			<ui5-tab id="tabTwentyEight" draggable="true" text="Twenty Eight"></ui5-tab>
			<ui5-tab id="tabTwentyNine" draggable="true" text="Twenty Nine"></ui5-tab>
			<ui5-tab id="tabThirty" draggable="true" text="Thirty"></ui5-tab>
		</ui5-tabcontainer>
	</section>

	<script>
		const tc = document.getElementById("tabContainerDnd");

		tc.addEventListener("before-tab-reorder", (e) => {
			// TODO: validate source.element
			const { source, destination } = e.detail;

			console.error(`Dragging "${source.element.id}" in "${destination.element.id}" ${destination.dropPlacement.toLowerCase()} index ${destination.index}`);

			if (destination.dropPlacement === "On" && (
				destination.element.children[destination.index].id === "tabFour" || destination.element.children[destination.index].id === "tabSeventeen"
			)) {
				e.preventDefault();
			}
		});

		tc.addEventListener("tab-reorder", (e) => {
			// TODO: validate source.element
			const { destination, source } = e.detail;

			if (destination.dropPlacement === "Before") {
				const insertBeforeElement = destination.element.children[destination.index];
				destination.element.insertBefore(
					source.element,
					insertBeforeElement
				);
			} else if (destination.dropPlacement === "After") {
				const insertAfterElement = destination.element.children[destination.index + 1] || null;

				destination.element.insertBefore(
					source.element,
					insertAfterElement
				);
			} else if (destination.dropPlacement === "On") {
				destination.element.children[destination.index].prepend(source.element);
				console.error(`Dropped "${source.element.id} in ${destination.element.id} on index ${destination.index}"`);
			}

			source.element.slot = destination.slot;

			// TODO: discuss how to focus
			setTimeout(() => {
				source.element.getFocusDomRef().focus();
			});
		});

		const densityCb = document.getElementById("density");
		densityCb.addEventListener("change", e => {
			document.body.classList.toggle("ui5-content-density-compact", e.target.checked);
		});

		const reorderCb = document.getElementById("reorder");
		reorderCb.addEventListener("change", e => {
			// TODO: iterate all tabs and set their "draggable"
		});

		const maxNestingLevelInput = document.getElementById("maxNestingLevelInput");
		maxNestingLevelInput.addEventListener("ui5-change", (event) => {
			tc.maxNestingLevel = event.target.value;
		});
	</script>
</body>

</html>