<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Drag Demo</title>
    <script src="%VITE_BUNDLE_PATH%" type="module"></script>
    <style>
        body {
            background-color: var(--sapBackgroundColor);
            color: var(--sapList_TextColor);
        }
        .demo-container {
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }
        .demo-section {
            max-width: 300px;
        }
        .info {
            font-size: 0.875rem;
            color: #a9a7a7;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- List 1: ui5-li with DragRegistry -->
        <div class="demo-section">
            <h3>ui5-li (DragRegistry)</h3>
            <div class="info">
                Selected: <span id="count1">0</span><br>
                Multiple selection mode, drag for multiple
            </div>
            
            <ui5-list id="list1" header-text="Standard Items" selection-mode="Multiple">
                <ui5-li movable data-id="1">Item 1</ui5-li>
                <ui5-li movable data-id="2">Item 2</ui5-li>
                <ui5-li movable data-id="3">Item 3</ui5-li>
                <ui5-li movable data-id="4">Item 4</ui5-li>
            </ui5-list>
        </div>

        <!-- List 2: ui5-li-custom with DragRegistry -->
        <div class="demo-section">
            <h3>ui5-li-custom (DragRegistry)</h3>
            <div class="info">
                Selected: <span id="count2">0</span><br>
                Multiple selection, red drag image
            </div>
            
            <ui5-list id="list2" header-text="Custom Items" selection-mode="Multiple">
                <ui5-li-custom movable data-id="5">Custom 1</ui5-li-custom>
                <ui5-li-custom movable data-id="6">Custom 2</ui5-li-custom>
                <ui5-li-custom movable data-id="7">Custom 3</ui5-li-custom>
                <ui5-li-custom movable data-id="8">Custom 4</ui5-li-custom>
            </ui5-list>
        </div>

        <!-- List 3: ui5-li without DragRegistry -->
        <div class="demo-section">
            <h3>ui5-li (Direct)</h3>
            <div class="info">
                Selected: <span id="count3">0</span><br>
                Multiple selection, purple drag image
            </div>
            
            <ui5-list id="list3" header-text="Direct Drag" selection-mode="Multiple">
                <ui5-li movable data-id="9">Direct 1</ui5-li>
                <ui5-li movable data-id="10">Direct 2</ui5-li>
                <ui5-li movable data-id="11">Direct 3</ui5-li>
                <ui5-li movable data-id="12">Direct 4</ui5-li>
            </ui5-list>
        </div>

        <!-- List 4: ui5-li-custom with Direct -->
        <div class="demo-section">
            <h3>ui5-li-custom (Direct)</h3>
            <div class="info">
                Selected: <span id="count4">0</span><br>
                Multiple selection, green drag image
            </div>
            
            <ui5-list id="list4" header-text="Custom Direct" selection-mode="Multiple">
                <ui5-li-custom movable data-id="13">Custom Direct 1</ui5-li-custom>
                <ui5-li-custom movable data-id="14">Custom Direct 2</ui5-li-custom>
                <ui5-li-custom movable data-id="15">Custom Direct 3</ui5-li-custom>
                <ui5-li-custom movable data-id="16">Custom Direct 4</ui5-li-custom>
            </ui5-list>
        </div>
    </div>

    <script type="module">
        import DragRegistry from "@ui5/webcomponents-base/dist/util/dragAndDrop/DragRegistry.js";
        
        const lists = [
            document.getElementById("list1"),
            document.getElementById("list2"), 
            document.getElementById("list3"),
            document.getElementById("list4")
        ];
        const counters = [
            document.getElementById("count1"),
            document.getElementById("count2"),
            document.getElementById("count3"),
            document.getElementById("count4")
        ];

        function getSelectedItems(list) {
            return list.getItems().filter(item => item.selected);
        }

        function updateUI(listIndex) {
            const selectedItems = getSelectedItems(lists[listIndex]);
            counters[listIndex].textContent = selectedItems.length;
        }

        function setupSelectionChangeListener(listIndex) {
            lists[listIndex].addEventListener("ui5-selection-change", () => {
                updateUI(listIndex);
            });
        }

        function createPurpleDragImage(count) {
            const element = document.createElement("div");
            element.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #8b5cf6, #a855f7);
                    border: 2px solid #7c3aed;
                    border-radius: 0.5rem;
                    padding: 1rem 1.5rem;
                    font-family: var(--sapFontFamily);
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: white;
                    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
                    white-space: nowrap;
                ">
                    ${count} Direct Items
                </div>
            `;
            element.style.cssText = "position: absolute; top: -1000px; left: -1000px;";
            document.body.appendChild(element);
            return element;
        }

        function createGreenDragImage(count) {
            const element = document.createElement("div");
            element.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #34d399, #10b981);
                    border: 2px solid #059669;
                    border-radius: 0.5rem;
                    padding: 1rem 1.5rem;
                    font-family: var(--sapFontFamily);
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: white;
                    box-shadow: 0 4px 12px rgba(52, 211, 153, 0.4);
                    white-space: nowrap;
                ">
                    ${count} Custom Direct Items
                </div>
            `;
            element.style.cssText = "position: absolute; top: -1000px; left: -1000px;";
            document.body.appendChild(element);
            return element;
        }

        // Setup List 1: Standard items with DragRegistry
        setupSelectionChangeListener(0);
        lists[0].addEventListener("dragstart", (e) => {
            const selectedItems = getSelectedItems(lists[0]);
            const draggedItem = e.target;
            
            // If dragged item is not selected, select only it
            if (!draggedItem.selected) {
                // Clear all selections first
                selectedItems.forEach(item => item.selected = false);
                draggedItem.selected = true;
                updateUI(0);
            }
            
            const currentSelected = getSelectedItems(lists[0]);
            if (currentSelected.length > 1) {
                DragRegistry.startMultipleDrag(e, currentSelected.length);
            }
        });

        // Setup List 2: Custom items with DragRegistry (component handles drag image)
        setupSelectionChangeListener(1);
        lists[1].addEventListener("dragstart", (e) => {
            const selectedItems = getSelectedItems(lists[1]);
            const draggedItem = e.target;
            
            // If dragged item is not selected, select only it
            if (!draggedItem.selected) {
                // Clear all selections first
                selectedItems.forEach(item => item.selected = false);
                draggedItem.selected = true;
                updateUI(1);
            }
            
            const currentSelected = getSelectedItems(lists[1]);
            // ListItemCustom component will handle the drag image
            if (currentSelected.length > 1) {
                DragRegistry.startMultipleDrag(e, currentSelected.length);
            }
        });

        // Setup List 3: Direct drag image (no DragRegistry)
        setupSelectionChangeListener(2);
        lists[2].addEventListener("dragstart", (e) => {
            const selectedItems = getSelectedItems(lists[2]);
            const draggedItem = e.target;
            
            // If dragged item is not selected, select only it
            if (!draggedItem.selected) {
                // Clear all selections first
                selectedItems.forEach(item => item.selected = false);
                draggedItem.selected = true;
                updateUI(2);
            }
            
            const currentSelected = getSelectedItems(lists[2]);
            if (currentSelected.length > 1) {
                const dragElement = createPurpleDragImage(currentSelected.length);
                e.dataTransfer.setDragImage(dragElement, 30, 15);
                requestAnimationFrame(() => {
                    if (dragElement.parentNode) {
                        dragElement.parentNode.removeChild(dragElement);
                    }
                });
            }
        });

        // Setup List 4: Custom direct drag image (no DragRegistry)
        setupSelectionChangeListener(3);
        lists[3].addEventListener("dragstart", (e) => {
            const selectedItems = getSelectedItems(lists[3]);
            const draggedItem = e.target;
            
            // If dragged item is not selected, select only it
            if (!draggedItem.selected) {
                // Clear all selections first
                selectedItems.forEach(item => item.selected = false);
                draggedItem.selected = true;
                updateUI(3);
            }
            
            const currentSelected = getSelectedItems(lists[3]);
            if (currentSelected.length > 1) {
                const dragElement = createGreenDragImage(currentSelected.length);
                e.dataTransfer.setDragImage(dragElement, 30, 15);
                requestAnimationFrame(() => {
                    if (dragElement.parentNode) {
                        dragElement.parentNode.removeChild(dragElement);
                    }
                });
            }
        });

        // Initialize
        [0, 1, 2, 3].forEach(updateUI);
    </script>
</body>
</html>