<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>List Drag and Drop</title>

	<script src="%VITE_BUNDLE_PATH%" type="module"></script>
	<link rel="stylesheet" type="text/css" href="./styles/List.css">
</head>

<body class="list1auto">
	<ui5-checkbox id="reorder" text="Movable items" checked></ui5-checkbox>
	<ui5-checkbox id="density" text="Compact density"></ui5-checkbox>
	<a id="link" href="http://sap.com" draggable="true">http://sap.com</a>

	<section>
		<h2>Drag and drop</h2>
		<div id="host1">
			<template shadowrootmode="open">
				<ui5-list id="listDnd1" header-text="List 1">
					<ui5-li id="bg1" movable>1. Bulgaria</ui5-li>
					<ui5-li id="de1" movable>1. Germany</ui5-li>
					<ui5-li id="es1" movable>1. Spain</ui5-li>
				</ui5-list>
			</template>
		</div>
		<br >
		<br >
		<br >

		<div id="host2">
			<template shadowrootmode="open">
				<div id="div1" style=" width: 350px;  height: 70px;  padding: 10px; border: 1px solid #aaaaaa;" ondrop="dropHandler(event)" ondragover="dragoverHandler(event)"></div>

				<img id="img1" src="https://sdk.openui5.org/test-resources/sap/f/images/Woman_avatar_01.png" draggable="true" ondragstart="dragstartHandler(event)" width="336" height="69">
			</template>
		</div>
	</section>

	<script>
		const list1 = document.getElementById("host1").shadowRoot.querySelector("#listDnd1");

		const handleBeforeItemMove = (e) => {
			const { destination, source } = e.detail;

			if (destination.placement === "Before" || destination.placement === "After") {
				e.preventDefault();
			}

			if (destination.placement === "On" && "allowsNesting" in destination.element.dataset) {
				e.preventDefault();
			}

			console.log(`Moving "${source.element.id}" ${destination.placement.toLowerCase()} "${destination.element.id}"`);
		};

		const list1HandleMoveOver = (e) => {
			const { destination, source } = e.detail;

			if (!list1.contains(source.element)) {
				// return;
			}

			handleBeforeItemMove(e);
		};

		const handleMove = (e) => {
			const { destination, source } = e.detail;

			switch (destination.placement) {
			case "Before":
				destination.element.before(source.element);
				break;
			case "After":
				destination.element.after(source.element);
				break;
			case "On":
				destination.element.prepend(source.element);
				break;
			}
		};

		list1.addEventListener("ui5-move-over", list1HandleMoveOver);
		list1.addEventListener("ui5-move", handleMove);

		const densityCb = document.getElementById("density");
		densityCb.addEventListener("ui5-change", e => {
			document.body.classList.toggle("ui5-content-density-compact", e.target.checked);
		});

		const reorderCb = document.getElementById("reorder");
		reorderCb.addEventListener("ui5-change", e => {
			list1.items.forEach((item) => item.movable = e.target.checked);
		});

		////////////////////

		function dragstartHandler(ev) {
			ev.dataTransfer.setData("text", ev.target.id);
		}

		function dragoverHandler(ev) {
			ev.preventDefault();
		}

		function dropHandler(ev) {
			ev.preventDefault();
			const data = ev.dataTransfer.getData("text");
			ev.target.appendChild(document.getElementById(data));
		}
	</script>
</body>

</html>